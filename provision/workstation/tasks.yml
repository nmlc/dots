---
- name: Add yarn repository
  yum_repository:
    name: yarn
    description: Yarn Repository
    gpgcheck: yes
    gpgkey: https://dl.yarnpkg.com/rpm/pubkey.gpg
    baseurl: https://dl.yarnpkg.com/rpm/
- name: Add kuberenetes yum repository
  yum_repository:
    name: kubernetes
    description: Kubernetes
    baseurl: https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
    gpgkey: https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
    gpgcheck: yes
    repo_gpgcheck: yes
- name: Install packages
  dnf:
    name:
      - vim
      - neovim
      - tmux
      - emacs
      - git
      - yarn
      - strace
      - ripgrep
      - kubectl
      - ansible
    state: latest
- name: Add user
  tags: linking
  user:
    name: "{{ user_name }}"
    password: "{{ user_password }}"
    append: true
- name: Add user to sudoers
  tags: linking
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^{{ user_name }} ALL='
    line: '{{ user_name }} ALL=(ALL) NOPASSWD: ALL'
- name: Set authorized key for user
  authorized_key:
    user: "{{ user_name }}"
    state: present
    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
- name: Download helm binary archive
  unarchive:
    # TODO fix this hardcoding
    src: https://get.helm.sh/helm-v3.1.2-linux-amd64.tar.gz
    dest: /tmp
    creates: /usr/local/bin/helm
    remote_src: yes
- name: Move helm binary into place
  command: >
    cp /tmp/linux-amd64/helm /usr/local/bin/helm
    creates=/usr/local/bin/helm
- name: install pip virtualenv
  pip:
    name: virtualenv
